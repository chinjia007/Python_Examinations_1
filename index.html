<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python一级训练营 - 课程主页</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=ZCOOL+XiaoWei&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #667eea;
            --primary-color-light: #7f9cf5;
            --primary-color-dark: #5a67d8;
            --accent-color: #9f7aea;
            --accent-color-light: #b794f4;
            --accent-color-dark: #805ad5;
            --text-color-dark: #1a202c;
            --text-color-medium: #4a5568;
            --text-color-light: #718096;
            --bg-light: #f7fafc;
            --bg-medium: #edf2f7;
            --border-color: #e2e8f0;
            --homepage-header-height: 110px; /* 新增：主页页眉高度变量 */
        }
        body {
            font-family: 'Noto Sans SC', 'Inter', sans-serif;
            /* New background: soft, ethereal gradient */
            background-image: linear-gradient(135deg, #f5f7fa, #e8edf2); 
            color: var(--text-color-medium);
            margin: 0;
            position: relative; /* Context for potential future absolute positioned children if any */
            overflow-x: hidden; /* Prevent horizontal scroll from large blurred pseudo-elements */
        }
        .homepage-header {
            background-image: linear-gradient(to right, var(--primary-color-dark), var(--primary-color), var(--accent-color-dark));
            padding: 0 2.5rem;
            display: flex;
            justify-content: space-between; /* 恢复为 space-between */
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: fixed; /* 固定定位 */
            top: 0;
            left: 0;
            right: 0;
            height: var(--homepage-header-height); /* 使用变量设置高度 */
            z-index: 1000;
            box-sizing: border-box;
        }
        .homepage-title-container {
            display: flex;
            align-items: center;
            flex-shrink: 0; /* 防止标题被压缩 */
        }
        .header-main-icon {
            font-size: 2.8rem; 
            margin-right: 1rem;
            color: #ffd43b;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.3));
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        .homepage-title {
            font-family: 'ZCOOL XiaoWei', sans-serif;
            font-size: 2.5rem;
            color: white;
            font-weight: bold;
            letter-spacing: 1.5px;
        }
        .training-ground-btn {
            background-image: linear-gradient(to right, #5EEAD4, var(--primary-color-light)); /* New gradient: Bright Teal to Primary Light */
            color: var(--text-color-dark); /* Dark text for better contrast on lighter gradient */
            padding: 0.85rem 1.8rem; /* Increased padding */
            border-radius: 10px; /* More rounded corners */
            font-weight: 700; /* Bolder text */
            text-decoration: none;
            transition: all 0.3s ease; /* Smooth transition for all properties */
            font-size: 1.05rem; /* Slightly larger font size */
            box-shadow: 0 4px 10px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.1); /* Enhanced shadow */
            border: none; /* No explicit border */
            display: inline-flex; /* Align icon and text */
            align-items: center; 
        }
        .training-ground-btn:hover {
            background-image: linear-gradient(to right, #4DDDBB, var(--primary-color)); /* Darkened gradient on hover */
            color: white; /* Text color might need to change if hover bg is dark enough */
            transform: translateY(-3px) scale(1.03); /* More pronounced hover effect */
            box-shadow: 0 6px 15px rgba(0,0,0,0.2), 0 2px 5px rgba(0,0,0,0.15); /* Enhanced shadow on hover */
        }
        .training-ground-btn .fa-keyboard { /* Changed icon class */
            margin-right: 0.6rem; /* Adjusted spacing for new icon */
        }

        .course-grid-container {
            padding: calc(var(--homepage-header-height) + 3rem) 2rem 3rem 2rem;
            max-width: 1880px; /* Increased from 1750px for more room */
            margin: 0 auto; /* Center the grid */
            position: relative; /* For absolute positioning of sidebar */
            overflow-x: hidden; /* Prevent horizontal scroll if sidebar pokes out slightly */
        }
        .course-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsive columns */
            gap: 2rem; /* Increased gap */
        }
        .course-card {
            background-color: white;
            border-radius: 16px; /* Slightly more rounded */
            box-shadow: 0 4px 8px rgba(0,0,0,0.06), 0 2px 4px rgba(0,0,0,0.05); /* Softer shadow */
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: inherit;
            border: 1px solid transparent; /* Prepare for hover border */
        }
        .course-card:hover {
            transform: translateY(-6px) scale(1.015); /* Adjusted hover effect */
            box-shadow: 0 10px 20px rgba(0,0,0,0.08), 0 4px 8px rgba(0,0,0,0.07);
            border-color: var(--primary-color-light);
        }
        .course-card-banner {
            height: 180px; /* Slightly taller banner */
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-start; /* Align badge to top */
            justify-content: flex-end; /* Align badge to right */
            padding: 0.8rem; /* Adjusted padding for badge positioning */
            position: relative; /* For potential ::before overlay */
        }
        /* Optional: Add a subtle overlay to banners for better text contrast if images are used later */
        /* .course-card-banner::before {\n            content: '';\n            position: absolute;\n            top: 0; left: 0; right: 0; bottom: 0;\n            background-color: rgba(0,0,0,0.15);\n            z-index: 1;\n        } */
        
        /* Frosted Glass Badge Style */
        .course-card-banner .lesson-number-badge-frosted {
            /* background-color will be set by JS (rgba) */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            /* color (text) will be set by JS */
            padding: 0.5rem 1rem; /* Adjusted padding */
            border-radius: 9px; /* Adjusted border-radius */
            font-size: 1.4rem; /* Adjusted font size (larger than original, smaller than last) */
            font-weight: 600; 
            box-shadow: 0 2px 6px rgba(0,0,0,0.18); /* Adjusted shadow */
            z-index: 2; 
            display: inline-flex; 
            align-items: center;
            border-width: 1px;
            border-style: solid;
            /* border-color will be set by JS (rgba) */
            line-height: 1.35; /* Adjusted line height */
        }
        .course-card-banner .lesson-number-badge-frosted .badge-icon {
            font-size: 0.85em; /* Adjusted relative to new badge font size */
            margin-right: 0.45rem; /* Adjusted spacing */
        }

        .course-card-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .course-card-title {
            font-size: 1.35rem; /* Adjusted */
            font-weight: 700; /* Bolder */
            color: var(--text-color-dark);
            margin-bottom: 0.6rem;
            line-height: 1.4;
        }
        .course-card-description {
            font-size: 0.9rem;
            color: var(--text-color-medium); /* Darker for better readability */
            line-height: 1.65;
            flex-grow: 1;
            margin-bottom: 1.5rem; /* More space before button */
        }
         .course-card-footer {
            margin-top: auto;
            text-align: right;
        }
        .course-card-button {
            /* background-color: var(--primary-color); */ /* Will be set by JS */
            color: white;
            padding: 0.7rem 1.4rem; /* Increased padding */
            border-radius: 8px; /* More rounded */
            text-decoration: none;
            font-weight: 600; /* Bolder */
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.3s ease; /* Added box-shadow transition */
            font-size: 0.9rem;
            display: inline-flex; /* Align icon and text */
            align-items: center;
            gap: 0.5rem; /* Space between text and icon */
            position: relative; /* ADDED for pseudo-element positioning */
            overflow: hidden;   /* ADDED to contain pseudo-element */
            z-index: 1; /* ADDED to ensure button content is above ::before */
        }
        .course-card-button:hover {
            /* background-color: var(--primary-color-dark); */ /* Will be handled by JS */
            transform: scale(1.03) translateY(-2px); /* Slight scale and lift on hover */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* ADDED subtle shadow enhancement */
        }

        /* ADDED: Shining effect for .course-card-button */
        .course-card-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%; /* Start off-screen to the left */
            width: 100%;
            height: 100%;
            background-image: linear-gradient(
                90deg, 
                rgba(255,255,255,0.1) 0%, 
                rgba(255,255,255,0.4) 50%, 
                rgba(255,255,255,0.1) 100%
            );
            transition: left 0.5s ease-in-out; /* Speed of the shine */
            z-index: -1; /* Place the shine behind the button's content */
        }
        .course-card-button:hover::before {
            left: 100%; /* Move shine across the button */
        }
        /* Ensure button content (text/icon) is above the pseudo-element */
        .course-card-button > * {
            position: relative;
            z-index: 2;
        }

        .homepage-footer {
            text-align: center;
            padding: 2rem;
            background-color: var(--text-color-dark);
            color: var(--bg-light);
            font-size: 0.9rem;
            margin-top: 2rem;
        }

        /* Placeholder banner colors for cards */
        .banner-color-1 { background-image: linear-gradient(to right, #667eea, #764ba2); }
        .banner-color-2 { background-image: linear-gradient(to right, #38b2ac, #319795); }
        .banner-color-3 { background-image: linear-gradient(to right, #ed8936, #dd6b20); }
        .banner-color-4 { background-image: linear-gradient(to right, #4299e1, #3182ce); }
        .banner-color-5 { background-image: linear-gradient(to right, #9f7aea, #805ad5); }
        .banner-color-6 { background-image: linear-gradient(to right, #48bb78, #38a169); }
        .banner-color-7 { background-image: linear-gradient(to right, #f56565, #e53e3e); }
        .banner-color-8 { background-image: linear-gradient(to right, #ecc94b, #d69e2e); }
        .banner-color-9 { background-image: linear-gradient(to right, #a0aec0, #718096); }
        .banner-color-10 { background-image: linear-gradient(to right, #718096, #4a5568); }

        /* 页脚样式 - 从 python_train.html 复制 */
        .app-footer {
            background: linear-gradient(to right, var(--primary-color-dark), var(--primary-color), var(--accent-color-dark));
            color: white;
            padding: 1.5rem 1rem;
            text-align: center;
            margin-top: 4rem; /* 保持或调整与上方内容的间距 */
            position: relative; /* 如果需要绝对定位子元素 */
            width: 100%;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            margin-right: 1.5rem;
        }
        
        .footer-logo .logo-icon {
            font-size: 1.8rem;
            margin-right: 0.75rem;
            color: #ffd43b; /* 图标颜色，可以根据需要调整 */
        }
        
        .footer-logo .logo-text {
            font-family: 'ZCOOL XiaoWei', sans-serif;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .footer-copyright {
            font-size: 0.95rem;
        }
        .footer-copyright i {
            margin: 0 0.25rem; /* 给图标之间以及和文字之间一点间距 */
        }
         /* 响应式页脚调整 - 如果需要，可以从python_train.html复制相关的@media查询 */
        @media (max-width: 768px) {
            .footer-content {
                flex-direction: column;
            }
            .footer-logo {
                margin-right: 0;
                margin-bottom: 0.75rem; /* Logo和版权信息之间的间距 */
            }
        }

        body::before {
            content: '';
            position: fixed; /* Fixed to viewport */
            width: 35vw; /* Use viewport units for responsiveness */
            height: 35vw;
            min-width: 250px; /* Minimum size */
            min-height: 250px;
            max-width: 450px; /* Maximum size */
            max-height: 450px;
            border-radius: 50%;
            background-color: rgba(127, 156, 245, 0.12); /* very transparent primary-color-light */
            top: 10vh; /* Position relative to viewport height */
            left: -10vw; /* Partially off-screen */
            z-index: -1; /* Behind content */
            filter: blur(50px); /* Soften the shape significantly */
        }

        body::after {
            content: '';
            position: fixed; /* Fixed to viewport */
            width: 40vw;
            height: 30vw;
            min-width: 300px;
            min-height: 200px;
            max-width: 500px;
            max-height: 350px;
            /* Asymmetrical radius for a more organic shape */
            border-radius: 60% 40% 30% 70% / 50% 60% 40% 50%; 
            background-color: rgba(183, 148, 244, 0.08); /* very transparent accent-color-light */
            bottom: 5vh;
            right: -15vw;
            z-index: -1; /* Behind content */
            filter: blur(60px); /* Soften the shape */
            transform: rotate(15deg); /* Slight rotation for dynamism */
        }

        /* New styles for sidebar layout and reminder card */
        .course-content-main {
            max-width: 1300px; /* Approx 4 cards (300px each) + 3 gaps (2rem each) */
            margin: 0 auto; /* Ensure course content itself is centered */
        }

        .exam-reminder-sidebar {
            /* flex: 1; */ /* Removed flex property */
            width: 220px; /* Make sidebar smaller */
            position: absolute;
            top: calc(var(--homepage-header-height) + 2rem); /* Increased top margin for clearance */
            right: 2rem; /* Position from the right edge of container */
            /* left: calc(50% + 650px + 2rem); */ /* Removed complex left positioning */
        }

        .reminder-card {
            background-color: white;
            padding: 1.2rem; /* Slightly reduced padding */
            border-radius: 10px; /* Slightly smaller radius */
            box-shadow: 0 3px 10px rgba(0,0,0,0.07);
            border: 1px solid var(--border-color);
        }

        .reminder-card h4 {
            font-size: 1.15rem; /* Slightly smaller title */
            color: var(--text-color-dark);
            margin-top: 0;
            margin-bottom: 0.8rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.6rem;
        }

        .reminder-card p {
            font-size: 0.9rem; /* Slightly smaller text */
            color: var(--text-color-medium);
            line-height: 1.5;
            margin-bottom: 0.7rem;
        }
        .reminder-card p strong {
            color: var(--text-color-dark);
        }

        .countdown {
            margin-top: 1rem;
            padding-top: 0.8rem;
            border-top: 1px dashed var(--border-color);
        }
        .countdown p {
            font-size: 0.85rem; /* Smaller text */
            color: var(--text-color-light);
            text-align: center;
            margin-bottom: 0.6rem;
        }
        .countdown-values {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .countdown-values div {
            font-size: 0.8rem; /* Smaller text */
            color: var(--text-color-medium);
        }
        .countdown-values span {
            display: block;
            font-size: 1.6rem; /* Smaller numbers */
            font-weight: bold;
            color: var(--primary-color-dark);
            margin-bottom: 0.15rem;
        }

        /* .reminder-details-btn:hover removed as button is removed */
        
        /* Responsive adjustments for sidebar */
        /* Removed the problematic @media (max-width: 1600px) block */

        @media (max-width: 1699px) { /* Adjusted breakpoint for stacking */
            .course-grid-container {
                padding-left: 1rem; /* Reduce padding on smaller screens */
                padding-right: 1rem;
            }
            .exam-reminder-sidebar {
                position: static; /* Stack sidebar */
                width: 100%; /* Full width on smaller screens */
                margin: 0 auto 2rem auto; /* Center and add bottom margin */
                max-width: 450px; /* Optional: constrain max-width when stacked, made a bit smaller */
            }
             /* Ensure course-content-main still uses available width */
            .course-content-main {
                max-width: 100%; 
            }
        }

        /* Styles for Learning Heatmap */
        .learning-heatmap-card {
            background-color: white;
            padding: 1.2rem;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.07);
            border: 1px solid var(--border-color);
            margin-top: 1.5rem; /* Space above this card */
        }

        .learning-heatmap-card h4 {
            font-size: 1.15rem;
            color: var(--text-color-dark);
            margin-top: 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.6rem;
            display: flex;
            align-items: center;
        }

        .heatmap-grid {
            display: grid;
            /* Adjust grid columns based on how many days you want to show per week */
            grid-template-columns: repeat(7, 1fr); /* Example: 7 days a week */
            gap: 3px; /* Small gap between cells */
            margin-bottom: 1rem;
            min-height: 100px; /* Placeholder height */
        }

        .heatmap-cell {
            width: 100%;
            padding-bottom: 100%; /* Creates a square aspect ratio */
            background-color: #f8f9fa; /* MODIFIED: Default very light gray for empty/future cells */
            border-radius: 3px;
            border: 1px solid #e9ecef; /* MODIFIED: Matching lighter border */
            box-sizing: border-box;
            font-size: 0.6rem; /* For potential day numbers, tiny */
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-color-light);
            position: relative; /* For tooltips if added later */
        }
        
        .heatmap-day-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.65em; /* Relative to cell size, make it small */
            color: var(--text-color-light); /* Light color for the date */
            z-index: 0; /* Behind flag if present */
        }

        .heatmap-exam-flag {
            color: var(--accent-color-dark); /* Or a distinct color like red: #e53e3e */
            font-size: 0.9em; /* Adjust size relative to cell */
            position: absolute; /* Position within the cell */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1; /* Ensure it's above background color */
        }

        .exam-day-cell {
            /* Optional: Add a special border or slightly different background to highlight exam day further */
            /* border: 1px solid var(--accent-color-dark) !important; */
        }
        
        /* Heatmap cell activity levels - colors from light to dark primary */
        .heatmap-cell.level-0 { background-color: #f0f3f5; border-color: #dee2e6; } /* MODIFIED: Very Light Grayish Blue */
        .heatmap-cell.level-1 { background-color: #bee3f8; border-color: #90cdf4; } /* Light Blue */
        .heatmap-cell.level-2 { background-color: #90cdf4; border-color: #63b3ed; } /* Medium Blue */
        .heatmap-cell.level-3 { background-color: #63b3ed; border-color: #4299e1; } /* Darker Blue */
        .heatmap-cell.level-4 { background-color: #4299e1; border-color: #3182ce; } /* Darkest Blue (like primary) */
        
        .heatmap-legend {
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Align to right by default */
            gap: 5px;
        }

        .heatmap-cell-legend {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border: 1px solid var(--text-color-light);
        }
        .heatmap-cell-legend.level-0 { background-color: #f0f3f5; border-color: #dee2e6; } /* MODIFIED: Very Light Grayish Blue */
        .heatmap-cell-legend.level-1 { background-color: #bee3f8; border-color: #90cdf4; }
        .heatmap-cell-legend.level-2 { background-color: #90cdf4; border-color: #63b3ed; }
        .heatmap-cell-legend.level-3 { background-color: #63b3ed; border-color: #4299e1; }
        .heatmap-cell-legend.level-4 { background-color: #4299e1; border-color: #3182ce; }

        .exam-day-cell .heatmap-day-number {
            /* Optional: Hide day number on exam day if flag is enough */
            /* display: none; */ 
        }

    </style>
</head>
<body>
    <header class="homepage-header">
        <div class="homepage-title-container">
            <i class="fab fa-python header-main-icon"></i>
            <h1 class="homepage-title">神奇喵喵Python一级训练营</h1>
        </div>
        <a href="python_train.html" class="training-ground-btn">
            <i class="fas fa-keyboard"></i> 训练场
        </a>
    </header>

    <main class="course-grid-container">
        <div class="course-content-main">
            <div id="course-grid" class="course-grid">
                <!-- 课程卡片将由JavaScript动态生成于此 -->
            </div>
        </div>
        <aside class="exam-reminder-sidebar">
            <div class="reminder-card">
                <h4><i class="fas fa-bullhorn" style="margin-right: 8px; color: var(--accent-color);"></i>重要提醒</h4>
                <p><strong>考试名称：</strong><br>【电子学会】Python一级</p>
                <p><strong>考试时间：</strong><br>2025年6月7日 (周六)<br>14:00 - 15:00</p>
                <div id="countdown-timer-sidebar" class="countdown">
                    <p>距离考试还有：</p>
                    <div class="countdown-values">
                        <div><span id="days">00</span> 天</div>
                        <div><span id="hours">00</span> 时</div>
                    </div>
                </div>
            </div>

            <div class="learning-heatmap-card">
                <h4><i class="fas fa-fire-alt" style="margin-right: 8px; color: var(--accent-color-dark);"></i>今日学习力</h4>
                <div id="learning-heatmap-grid" class="heatmap-grid">
                    <!-- 热力图格子将由JavaScript动态生成 -->
                </div>
                <div class="heatmap-legend">
                    <span style="font-size: 0.75rem; color: var(--text-color-light);">少</span>
                    <span class="heatmap-cell-legend level-0"></span>
                    <span class="heatmap-cell-legend level-1"></span>
                    <span class="heatmap-cell-legend level-2"></span>
                    <span class="heatmap-cell-legend level-3"></span>
                    <span class="heatmap-cell-legend level-4"></span>
                    <span style="font-size: 0.75rem; color: var(--text-color-light);">多</span>
                </div>
            </div>

        </aside>
    </main>

    <footer class="app-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <i class="fas fa-cat logo-icon"></i>
                <span class="logo-text">神奇喵喵Python训练营</span>
            </div>
            <div class="footer-copyright">
                <p>&copy; 2024 神奇喵喵Python训练营. <i class="fas fa-graduation-cap"></i> <i class="fas fa-code"></i> <i class="fas fa-laptop-code"></i> 你最厉害！(๑•̀ㅂ•́)و✧</p>
            </div>
        </div>
    </footer>

    <script>
        // Helper function to darken/lighten a hex color
        function darkenColor(hex, percent) {
            hex = hex.replace(/^#/, '');
            let r = parseInt(hex.substring(0, 2), 16);
            let g = parseInt(hex.substring(2, 4), 16);
            let b = parseInt(hex.substring(4, 6), 16);

            r = Math.min(255, Math.max(0, Math.round(r * (1 - percent / 100))));
            g = Math.min(255, Math.max(0, Math.round(g * (1 - percent / 100))));
            b = Math.min(255, Math.max(0, Math.round(b * (1 - percent / 100))));

            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }

        // Helper function to convert hex to rgba
        function hexToRgba(hex, alpha = 1) {
            hex = hex.replace(/^#/, '');
            if (hex.length === 3) {
                hex = hex.split('').map(char => char + char).join('');
            }
            const r = parseInt(hex.substring(0, 2), 16);
            const g = parseInt(hex.substring(2, 4), 16);
            const b = parseInt(hex.substring(4, 6), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Helper function to get contrasting text color (black or white)
        function getContrastTextColor(hexBackground) {
            hexBackground = hexBackground.replace(/^#/, '');
            if (hexBackground.length === 3) {
                hexBackground = hexBackground.split('').map(char => char + char).join('');
            }
            const r = parseInt(hexBackground.substring(0, 2), 16);
            const g = parseInt(hexBackground.substring(2, 4), 16);
            const b = parseInt(hexBackground.substring(4, 6), 16);
            // Calculate luminance (YIQ formula)
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 128) ? 'var(--text-color-dark)' : '#FFFFFF'; // Use CSS var for dark text
        }

        const courseThemeColors = {
            "banner-color-1": "#667eea",
            "banner-color-2": "#38b2ac",
            "banner-color-3": "#ed8936",
            "banner-color-4": "#4299e1",
            "banner-color-5": "#9f7aea",
            "banner-color-6": "#48bb78",
            "banner-color-7": "#f56565",
            "banner-color-8": "#ecc94b",
            "banner-color-9": "#718096", // Using the darker shade for lesson 9 as decided
            "banner-color-10": "#4a5568" // Using the darker shade for lesson 10 as decided
        };

        const courseBadgeBgColors = {
            "banner-color-1": "#764ba2",
            "banner-color-2": "#319795",
            "banner-color-3": "#dd6b20",
            "banner-color-4": "#3182ce",
            "banner-color-5": "#805ad5",
            "banner-color-6": "#38a169",
            "banner-color-7": "#e53e3e",
            "banner-color-8": "#d69e2e",
            "banner-color-9": "#718096", // Corresponds to the second color in its gradient
            "banner-color-10": "#4a5568" // Corresponds to the second color in its gradient
        };

        const courses = [
            { number: 1, title: "Python与IDLE初识", description: "学习Python编程语言的基础概念，熟悉IDLE开发环境，并编写第一个Python程序。", bannerClass: "banner-color-1" },
            { number: 2, title: "程序结构与基本输出", description: "理解程序的基本组成部分，掌握Python代码格式、注释以及使用print()函数进行多样化输出。", bannerClass: "banner-color-2" },
            { number: 3, title: "变量与数据类型 (数值型)", description: "深入理解变量的概念、命名规则和赋值，重点学习整数和浮点数这两种核心数值类型。", bannerClass: "banner-color-3" },
            { number: 4, title: "数据类型 (字符串)", description: "掌握字符串的创建、基本操作（连接与重复）以及多行字符串的使用方法。", bannerClass: "banner-color-4" },
            { number: 5, title: "基本输入与类型转换", description: "学习使用input()获取用户输入，并掌握int(), float(), str()等函数进行数据类型转换。", bannerClass: "banner-color-5" },
            { number: 6, title: "基本的数学运算", description: "熟练运用Python的算术运算符，理解运算优先级，并学会使用复合赋值运算符简化代码。", bannerClass: "banner-color-6" },
            { number: 7, title: "逻辑表达式与比较运算符", description: "认识布尔值，掌握各种比较运算符，并能编写简单的逻辑判断表达式。", bannerClass: "banner-color-7" },
            { number: 8, title: "逻辑运算符详解", description: "深入学习and, or, not逻辑运算符，理解其运算规则、真值表及短路求值特性。", bannerClass: "banner-color-8" },
            { number: 9, title: "Turtle图形库基础与应用", description: "探索Turtle库，学习控制画笔移动、状态、颜色，绘制基本图形并进行填充。", bannerClass: "banner-color-9" },
            { number: 10, title: "总复习与模拟备考", description: "全面回顾一级考点，巩固编程技能，学习调试方法，并通过模拟练习熟悉考试。", bannerClass: "banner-color-10" }
        ];

        const courseGrid = document.getElementById('course-grid');

        courses.forEach(course => {
            const cardLink = document.createElement('a');
            cardLink.href = `lesson${course.number}.html`;
            cardLink.className = 'course-card';

            const banner = document.createElement('div');
            banner.className = `course-card-banner ${course.bannerClass}`;
            
            const badge = document.createElement('span');
            badge.className = 'lesson-number-badge-frosted'; // Use new frosted badge class
            
            const themeColorHex = courseThemeColors[course.bannerClass] || '#667eea'; // Default theme color

            badge.style.backgroundColor = hexToRgba(themeColorHex, 0.3); // Frosted background
            badge.style.borderColor = hexToRgba(themeColorHex, 0.45);    // Slightly more opaque border
            badge.style.color = getContrastTextColor(themeColorHex);    // Dynamic text color

            const badgeIcon = document.createElement('i');
            badgeIcon.className = 'fas fa-paw badge-icon'; // Changed to paw icon
            
            badge.appendChild(badgeIcon);
            badge.appendChild(document.createTextNode(` 第 ${course.number}课`));
            
            banner.appendChild(badge);

            const content = document.createElement('div');
            content.className = 'course-card-content';

            const title = document.createElement('h3');
            title.className = 'course-card-title';
            title.textContent = course.title;

            const description = document.createElement('p');
            description.className = 'course-card-description';
            description.textContent = course.description;
            
            const footer = document.createElement('div');
            footer.className = 'course-card-footer';

            const button = document.createElement('span');
            button.className = 'course-card-button';
            const buttonThemeColor = courseThemeColors[course.bannerClass] || 'var(--primary-color)'; // Default
            button.style.backgroundColor = buttonThemeColor;
            button.onmouseover = function() { this.style.backgroundColor = darkenColor(buttonThemeColor, 15); }; // Darken by 15% on hover
            button.onmouseout = function() { this.style.backgroundColor = buttonThemeColor; };
            
            button.textContent = '进入课程 ';
            const buttonIcon = document.createElement('i');
            buttonIcon.className = 'fas fa-arrow-right';
            button.appendChild(buttonIcon);
            
            footer.appendChild(button);

            content.appendChild(title);
            content.appendChild(description);
            content.appendChild(footer);

            cardLink.appendChild(banner);
            cardLink.appendChild(content);

            courseGrid.appendChild(cardLink);
        });

        // JavaScript for Sidebar Countdown Timer
        function updateCountdownSidebar() {
            const examDate = new Date("June 7, 2025 14:00:00").getTime();
            const now = new Date().getTime();
            const distance = examDate - now;

            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');

            if (distance < 0) {
                document.getElementById("countdown-timer-sidebar").innerHTML = "<p style='font-size: 1.1rem; color: var(--accent-color-dark); font-weight: bold;'>考试已经开始/结束！</p>";
                if (daysEl) daysEl.textContent = "00";
                if (hoursEl) hoursEl.textContent = "00";
                clearInterval(countdownIntervalSidebar);
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

            if (daysEl) daysEl.textContent = days.toString().padStart(2, '0');
            if (hoursEl) hoursEl.textContent = hours.toString().padStart(2, '0');
        }

        // Initialize countdown and update every second
        updateCountdownSidebar(); // Initial call
        const countdownIntervalSidebar = setInterval(updateCountdownSidebar, 1000);

        // --- Learning Heatmap Functionality ---
        const heatmapGrid = document.getElementById('learning-heatmap-grid');
        const WEEKS_TO_SHOW = 5; // Show last 5 weeks (approx)
        const DAYS_IN_WEEK = 7;
        const totalDaysToShow = WEEKS_TO_SHOW * DAYS_IN_WEEK;
        const LEARNING_DATA_KEY = 'learningHeatmapData';

        // Color levels (0: least, 4: most activity)
        const activityColorClasses = [
            'level-0', // Very light activity or just opened
            'level-1',
            'level-2',
            'level-3',
            'level-4'  // Max activity
        ];
        const TIME_THRESHOLDS = [5, 15, 30, 60]; // Minutes for each level (e.g., >5min=level-1, >15min=level-2 etc.)
                                                  // level-0 is for < TIME_THRESHOLDS[0]

        let dailyVisitStartTime = null;
        let todayLearningInterval = null;

        // --- Constants for Heatmap Date Range ---
        const EXAM_DATE_STR = "2025-06-07";
        const EXAM_DATE = new Date(EXAM_DATE_STR + "T00:00:00"); // Ensure it's start of day for comparisons
        const WEEKS_AROUND_EXAM = 5; // Show approx 5 weeks, with exam date being the endpoint.
        // --- End Constants ---

        function getLearningData() {
            const data = localStorage.getItem(LEARNING_DATA_KEY);
            return data ? JSON.parse(data) : {};
        }

        function saveLearningData(data) {
            localStorage.setItem(LEARNING_DATA_KEY, JSON.stringify(data));
        }

        function getFormattedDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        function renderHeatmap() {
            if (!heatmapGrid) return;
            heatmapGrid.innerHTML = ''; // Clear previous grid
            const learningData = getLearningData();
            
            // Calculate the end date for the heatmap (Saturday of the week EXAM_DATE is in)
            let heatmapEndDate = new Date(EXAM_DATE);
            heatmapEndDate.setDate(EXAM_DATE.getDate() + (6 - EXAM_DATE.getDay())); // Go to Saturday of exam week

            // Calculate the start date (Sunday, WEEKS_AROUND_EXAM weeks before)
            let heatmapStartDate = new Date(heatmapEndDate);
            heatmapStartDate.setDate(heatmapEndDate.getDate() - (WEEKS_AROUND_EXAM * DAYS_IN_WEEK) + 1);
            // Ensure it's a Sunday
            heatmapStartDate.setDate(heatmapStartDate.getDate() - heatmapStartDate.getDay());

            const totalCellsToRender = WEEKS_AROUND_EXAM * DAYS_IN_WEEK;
            
            for (let i = 0; i < totalCellsToRender; i++) {
                const cellDate = new Date(heatmapStartDate);
                cellDate.setDate(heatmapStartDate.getDate() + i);
                const dateStr = getFormattedDate(cellDate);
                
                const cell = document.createElement('div');
                cell.classList.add('heatmap-cell');
                cell.dataset.date = dateStr;
                cell.title = dateStr; // Tooltip with full date

                // Add day number text
                const dayNumberText = document.createElement('span');
                dayNumberText.className = 'heatmap-day-number';
                dayNumberText.textContent = cellDate.getDate();
                cell.appendChild(dayNumberText);

                // Add flag icon for exam date
                if (dateStr === EXAM_DATE_STR) {
                    const flagIcon = document.createElement('i');
                    flagIcon.className = 'fas fa-flag heatmap-exam-flag';
                    cell.appendChild(flagIcon);
                    cell.classList.add('exam-day-cell'); // Special class for exam day
                }

                const dayData = learningData[dateStr];
                let level = 0;
                if (dayData && dayData.durationMinutes > 0) {
                    if (dayData.durationMinutes >= TIME_THRESHOLDS[3]) level = 4;
                    else if (dayData.durationMinutes >= TIME_THRESHOLDS[2]) level = 3;
                    else if (dayData.durationMinutes >= TIME_THRESHOLDS[1]) level = 2;
                    else if (dayData.durationMinutes >= TIME_THRESHOLDS[0]) level = 1;
                    else level = 0; // Still counts as visited if duration > 0 but < first threshold
                }
                cell.classList.add(activityColorClasses[level]);
                heatmapGrid.appendChild(cell);
            }
        }
        
        function updateTodayActivity() {
            const todayStr = getFormattedDate(new Date());
            const learningData = getLearningData();
            
            if (!learningData[todayStr]) {
                learningData[todayStr] = { durationMinutes: 0 };
            }
            // Increment duration (e.g., by 1 minute)
            // For more fine-grained, this could be based on actual time difference
            learningData[todayStr].durationMinutes += 1; 
            saveLearningData(learningData);
            
            // Update cell color for today on the heatmap
            const todayCell = heatmapGrid.querySelector(`.heatmap-cell[data-date="${todayStr}"]`);
            if (todayCell) {
                activityColorClasses.forEach(cls => todayCell.classList.remove(cls)); // Remove old level
                let level = 0;
                const duration = learningData[todayStr].durationMinutes;
                if (duration >= TIME_THRESHOLDS[3]) level = 4;
                else if (duration >= TIME_THRESHOLDS[2]) level = 3;
                else if (duration >= TIME_THRESHOLDS[1]) level = 2;
                else if (duration >= TIME_THRESHOLDS[0]) level = 1;
                else level = 0;
                todayCell.classList.add(activityColorClasses[level]);
            }
        }

        function startTrackingToday() {
            const todayStr = getFormattedDate(new Date());
            const learningData = getLearningData();

            // Mark today as visited (level 0 at least if not already more)
            if (!learningData[todayStr] || learningData[todayStr].durationMinutes === 0) {
                 if (!learningData[todayStr]) learningData[todayStr] = { durationMinutes: 0 };
                 // Slightly increment to mark as active for level 0 if it's truly 0
                 // This ensures it gets an initial color if TIME_THRESHOLDS[0] is > 0
                 learningData[todayStr].durationMinutes = 0.1; 
                 saveLearningData(learningData);
                 renderHeatmap(); // Re-render to show initial mark for today
            } else {
                 renderHeatmap(); // Render existing data
            }

            // Clear any existing interval before starting a new one
            if (todayLearningInterval) {
                clearInterval(todayLearningInterval);
            }
            // Update duration every minute
            todayLearningInterval = setInterval(updateTodayActivity, 60000); // 60000ms = 1 minute
        }

        // Initial setup
        if (heatmapGrid) { // Ensure the element exists
            renderHeatmap();
            startTrackingToday();
        }

        // Save data on page leave
        window.addEventListener('beforeunload', () => {
            // This is a good place to ensure the latest minute is counted if needed,
            // but setInterval should handle most cases.
            // For simplicity, we rely on the interval for now.
            // If more precise tracking on exit is needed, calculate elapsed time since last save here.
        });

    </script>
</body>
</html>